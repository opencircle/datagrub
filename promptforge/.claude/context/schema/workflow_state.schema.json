{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://promptforge.ai/schemas/workflow_state.schema.json",
  "title": "Workflow State Schema",
  "description": "Schema for tracking Checker Agent approval workflow state",
  "type": "object",
  "required": ["workflow_version", "last_updated", "pending_approvals", "approval_history", "enforcement_rules"],
  "properties": {
    "workflow_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Semantic version of workflow schema",
      "examples": ["1.0", "1.1", "2.0"]
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of last workflow state update"
    },
    "pending_approvals": {
      "type": "array",
      "description": "Tasks awaiting Checker Agent approval",
      "items": {
        "type": "object",
        "required": ["task_uuid", "architect_agent", "timestamp", "status"],
        "properties": {
          "task_uuid": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-_]+$",
            "description": "Unique task identifier"
          },
          "architect_agent": {
            "type": "string",
            "enum": [
              "UI_Architect_Agent",
              "API_Architect_Agent",
              "DB_Architect_Agent",
              "UX_Specialist_Agent"
            ],
            "description": "Architect agent that performed work"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When approval checkpoint was added"
          },
          "status": {
            "type": "string",
            "const": "awaiting_checker_approval",
            "description": "Current status (always awaiting for pending items)"
          }
        }
      }
    },
    "approval_history": {
      "type": "array",
      "description": "Completed approval records",
      "items": {
        "type": "object",
        "required": ["task_uuid", "architect_agent", "status", "approved_at"],
        "properties": {
          "task_uuid": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-_]+$",
            "description": "Unique task identifier"
          },
          "architect_agent": {
            "type": "string",
            "enum": [
              "UI_Architect_Agent",
              "API_Architect_Agent",
              "DB_Architect_Agent",
              "UX_Specialist_Agent"
            ],
            "description": "Architect agent that performed work"
          },
          "status": {
            "type": "string",
            "enum": ["APPROVED", "PASS_WITH_WARNINGS", "BLOCKED"],
            "description": "Final approval status from Checker Agent"
          },
          "approved_at": {
            "type": "string",
            "format": "date-time",
            "description": "When approval was recorded"
          }
        }
      }
    },
    "enforcement_rules": {
      "type": "object",
      "required": [
        "mandatory_checker_approval",
        "block_user_response_until_approved",
        "allow_parallel_approvals",
        "max_pending_approvals"
      ],
      "properties": {
        "mandatory_checker_approval": {
          "type": "boolean",
          "description": "Whether Checker approval is required for all architect work"
        },
        "block_user_response_until_approved": {
          "type": "boolean",
          "description": "Whether to block user-facing responses until approved"
        },
        "allow_parallel_approvals": {
          "type": "boolean",
          "description": "Whether multiple approvals can be pending simultaneously"
        },
        "max_pending_approvals": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Maximum number of pending approvals allowed"
        }
      }
    },
    "workflow_description": {
      "type": "object",
      "description": "Optional metadata about workflow purpose and steps"
    },
    "usage_examples": {
      "type": "array",
      "description": "Optional usage examples for workflow operations"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "workflow_version": "1.0",
      "last_updated": "2025-10-11T10:45:00Z",
      "pending_approvals": [],
      "approval_history": [
        {
          "task_uuid": "task-eval-selector-001",
          "architect_agent": "UI_Architect_Agent",
          "status": "APPROVED",
          "approved_at": "2025-10-11T10:30:00Z"
        }
      ],
      "enforcement_rules": {
        "mandatory_checker_approval": true,
        "block_user_response_until_approved": true,
        "allow_parallel_approvals": false,
        "max_pending_approvals": 3
      }
    }
  ]
}
